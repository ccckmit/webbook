<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../css/book.css" type="text/css" />
</head>
<body>
<div id="header_wrap">
  <h1><a href="index.htm">電子書：Web 程式設計</a></h1>
  <table id="bar" border="0" style="border:0;"><tr style="border:0;">
    <td style="text-align:left;border:0;"> <a href="book.html">目錄</a> | <a href="download.html">下載</a> | <a href="course.html">課程</a> | <a href="forum.html">討論</a> | <a href="exam.html">測驗</a></td>
    <td style="text-align:right;border:0;"><a href="http://ccckmit.wikidot.com/">陳鍾誠</a> 於 <a href="http://www.nqu.edu.tw/">金門大學</a></td>
  </tr></table>
</div>
<div id="content">
<div id="TOC">
<ul>
<li><a href="#javascript-語言基礎">JavaScript 語言基礎</a><ul>
<li><a href="#javascript-基本語法">JavaScript 基本語法</a></li>
<li><a href="#javascript-的物件導向語法">JavaScript 的物件導向語法</a></li>
<li><a href="#javascript-的特殊技巧-closure-與匿名函數">JavaScript 的特殊技巧 – Closure 與匿名函數</a></li>
<li><a href="#參考文獻">參考文獻</a></li>
</ul></li>
</ul>
</div>
<h1 id="javascript-語言基礎"><a href="#javascript-語言基礎">JavaScript 語言基礎</a></h1>
<p>JavaScript 是目前在瀏覽器上唯一通用的程式語言，這種語言經常遭受到許多誤解，像是 「JavaScript 就是 Java 語言的簡化版」、「JavaScript 語言很難用」、「JavaScript 語言設計很差勁」等等。</p>
<p>然而，這些誤解其實是我們不瞭解 JavaScript 所造成的。如果您用心去瞭解 JavaScript，您會發現這是一個「簡單、輕巧又優美」的語言，其原型導向的設計方式，用很簡單的概念達成了物件導向語言的功能，真的很適合做為瀏覽器上的共通語言。</p>
<p>JavaScript 雖然是一種物件導向語言，但是更精確的說，JavaScript 事實上是一種「原型導向」的語言，其中每個物件的 _prototype 欄位都可以指向他的原型，然後用來 clone (自體繁殖) 出新的物件，您可以用 function 型態宣告一個物件，如此該物件就自動具有建構函數了，這種做法是非常簡單、奇特、但卻又彈性十足的方法。</p>
<p>雖然 JavaScript 語言有許多優點，但是也有不少缺點，例如有些語法的邏輯很奇怪，而且 JavaScript 的物件導向並非像 Java, C#, Ruby 等語言那樣傳統，而是採用原型導向的方式，這讓傳統物件導向的使用者在學習 JavaScript 時會感到困難。不過一但您理解了原型導向的精神之後，就會發現這種方法真的有不少優點了。為了較深入的理解 JavaScript ，讓我們先來看看 JavaScript 的歷史！</p>
<p>Web 技術在 1990 年開始成形，早期網際網路只有文字，沒有圖像、音效，且操作非常繁瑣。當時還是大學生的馬克·安德生（Marc Andreessen）被伊利諾伊大學的電腦應用中心聘為臨時工作人員，馬克·安德生提出設計一種簡單的瀏覽程式想法，能方便的檢索網路資料，於是招聘了幾個程式設計師花了六週的時間開發。於是誕生了 Mosaic 瀏覽器。 Mosaic的出現，算是點燃了後期網際網路熱潮的火種。後來在1994年4月，馬克.安德生和Silicon Graphics公司的創始人吉姆·克拉克（Jim Clark）在美國加州設立了一家公司，進一步改善瀏覽器技術，並且創造出了 Netscape 瀏覽器。</p>
<p>當時瀏覽器只能顯示文字與圖片，無法做出像功能表這樣需要即時互動的網頁，於是 Netscape 公司的Brendan Eich設計出了 LiveScript，這是一種動態、弱型別、基於原型的語言，用來寫一些讓網頁可以動起來的小程式。</p>
<p>由於Netscape在與昇陽（Sun）合作的關係，所以 Netscape 將 LiveScript 改名為JavaScript，後來甲骨文 (Oracle) 公司買下了昇陽，所以 JavaScript是甲骨文公司的註冊商標。為了避免侵犯商標權，於是 Ecma國際（前身為歐洲電腦製造商協會）將其以JavaScript為基礎所制定的語言改稱為 ECMAScript。所以現在我們所說的 JavaScript，其真正意義其實應該是 ECMAScript。</p>
<p>現在、JavaScript 已經成為一種非常重要的程式語言，JavaScript 除了用在瀏覽器之外，也被用在許多其他領域，像是您可以用 node.js 在 Server端撰寫 JavaScript 的程式，也可以在 Unity3D 當中用 JavaScript 撰寫遊戲程式，更可以在 Tatinum 當中用 JavaScript 撰寫手機的 APP 然後放到 iPhone, iPad 或 Android 上面去執行。</p>
<h2 id="javascript-基本語法"><a href="#javascript-基本語法">JavaScript 基本語法</a></h2>
<p>JavaScript 最常被嵌入到 HTML 網頁中，以便讓網頁顯式出一些特別的動態效果，因此含有 JavaScript 的網頁通常也被稱為動態網頁，以下是一個 HTML 內嵌 JavaScript 的簡單範例與顯示結果。</p>
<p>原始碼</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
<span class="kw">&lt;body&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;</span>
<span class="kw">var</span> x =<span class="dv">5</span>, y=<span class="dv">7</span>;
<span class="kw">var</span> s = <span class="st">&quot;Hello! &quot;</span>
t = s + x;
z = x * y;
<span class="er">document.write(&quot;&lt;pre&gt;x=&quot;+x+&quot;\ny=&quot;+y+&quot;\ns=&quot;+s+&quot;\nt=&quot;+t+&quot;\nz=&quot;+z+&quot;&lt;/pre&gt;&quot;);</span>
<span class="kw">&lt;/script&gt;</span>
<span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<p>執行結果</p>
<p>JavaScript 的 if 語法也很簡單，基本上與 C 、Java、C# 等語言都相同，以下是一個簡單的範例。</p>
<p>原始碼</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
<span class="kw">&lt;body&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;</span>
<span class="kw">var</span> score = <span class="dv">61</span>;
<span class="kw">if</span> (score &gt;= <span class="dv">60</span>)
<span class="er">  document.write(&quot;及格&quot;);</span>
<span class="kw">else</span>
<span class="er">  document.write(&quot;不及格&quot;);</span>
<span class="kw">&lt;/script&gt;</span>
<span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<p>執行結果</p>
<p>JavaScript 的迴圈語法也是繼承 C 語言的，以下是一個範例：</p>
<p>原始碼</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
<span class="kw">&lt;body&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;</span>
<span class="kw">for</span> (i=<span class="dv">1</span>;i&lt;=<span class="dv">10</span>;i++) {
  <span class="kw">if</span> (i == <span class="dv">3</span>) <span class="kw">continue</span>;
  <span class="kw">if</span> (i == <span class="dv">8</span>) <span class="kw">break</span>;
  <span class="ot">document</span>.<span class="fu">write</span>(<span class="st">&quot;i=&quot;</span>+i+<span class="st">&quot;&lt;BR/&gt;&quot;</span>);
}
<span class="kw">&lt;/script&gt;</span>
<span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<p>執行結果</p>
<p>在 JavaScript 當中，函數的定義有兩種寫法，一種是正常的函數宣告，另一種是把函數當變數的指定方法。事實上，JavaScript 的函數也是一種基本型態，具有這種特點的語言通常稱為函數式語言。這種特性非常好用，因為在函數式語言當中，函數在也不是次等公民，而是一種基本型態，以下是一個 JavaScript 的函數宣告範例。</p>
<p>原始碼</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
<span class="kw">&lt;body&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;</span>
<span class="co">// 第一種寫法，將匿名函數指定給變數。</span>
<span class="kw">var</span> add = <span class="kw">function</span>(a,b) {     
  <span class="kw">return</span> a+b;
}
<span class="co">// 第二種寫法，直接宣告函數，該函式是一個函數物件</span>
<span class="er">function sub(a,b) {         </span>
  <span class="kw">return</span> a-b;
}
<span class="er">document.write(&quot;add(3,5)=&quot;+add(3,5) +&quot; sub(7,2)=&quot;+sub(7,2));</span>
<span class="kw">&lt;/script&gt;</span>
<span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<p>執行結果</p>
<p>在 JavaScript 當中，您若要宣告一個陣列時，可以採用 var a = new Array() 的方法，建立一個陣列物件，然後用 a[i] 這樣的方法，存取陣列中的元素。</p>
<p>原始碼</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
<span class="kw">&lt;body&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;</span>
<span class="kw">var</span> x;
<span class="er">var friends = new Array();</span>
<span class="er">friends[0] = &quot;John&quot;;</span>
<span class="er">friends[1] = &quot;Mary&quot;;</span>
<span class="er">friends[2] = &quot;George&quot;;</span>
<span class="kw">for</span> (p <span class="kw">in</span> friends) {
  <span class="ot">document</span>.<span class="fu">write</span>(p + <span class="st">&quot;:&quot;</span>+ friends[p] + <span class="st">&quot;&lt;br/&gt;&quot;</span>);
}
<span class="kw">&lt;/script&gt;</span>
<span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<p>執行結果</p>
<h2 id="javascript-的物件導向語法"><a href="#javascript-的物件導向語法">JavaScript 的物件導向語法</a></h2>
<p>雖然說，JavaScript 也能實作很好的物件導向功能，但是如果我們說 JavaScript 是一種物件導向語言，那麼會很容易造成混淆。因為 JavaScript 的物件導向非常非常的特別，與 Java, C++, C# 等語言的物件導向實作方法有很大的不同。</p>
<p>嚴格的說，JavaScript 是一種原型導向語言，原型導向是一種特別簡單的物件導向實作機制，以下是幾個 JavaScript 的物件範例：</p>
<pre class="sourceCode JavaScript"><code class="sourceCode javascript">obj = <span class="kw">new</span> <span class="fu">Object</span>()
<span class="ot">obj</span>.<span class="fu">x</span> = <span class="dv">3</span>;        <span class="co">// 為 obj 新增一個欄位 x，其值設定為 3</span>
<span class="ot">obj</span>.<span class="fu">y</span> = <span class="dv">5</span>;        <span class="co">// 為 obj 新增一個欄位 y，其值設定為 5</span>
<span class="ot">obj</span>.<span class="fu">z</span> = <span class="ot">obj</span>.<span class="fu">x</span> + <span class="ot">obj</span>.<span class="fu">y</span>;    <span class="co">// 為 obj 新增一個欄位 z，其值設定為 x+y</span></code></pre>
<p>對於曾經使用像 Java 這種傳統物件導向語言的人而言，會感覺到上述的程式很奇特，因為 obj 一開始只是一個空物件，並沒有包含任何的欄位，但是我們透過指定的方式，動態的為物件增添了 x, y, z 等欄位。</p>
<p>物件導向基本上有三大特性，1.封裝 2. 繼承 3. 多型，瞭解這三個特性的實作方式，通常就可以學會一種語言的物件導向語法了，以下我們將分別針對 JavaScript 中的這三大特性進行介紹。</p>
<h3 id="javascript-物件的封裝"><a href="#javascript-物件的封裝">JavaScript 物件的封裝</a></h3>
<p>物件導向中的封裝特性，是指將「資料」與「函數」封入一種稱為「物件」的結構當中，以下是 JavaScript 的一個物件範例，其中 x, y 是資料，而 sum 則是函數，這些成員都被封裝在 obj 這樣一個建構函數當中，因此我們呼叫 var o = new obj() 這個指令時，就會建立一個新的物件，並傳回給 o 變數。</p>
<p>程式範例: object.htm</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
<span class="kw">&lt;body&gt;</span>

<span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;</span>
<span class="er">function obj() {</span>
  <span class="kw">this</span>.<span class="fu">x</span> = <span class="dv">3</span>;        <span class="co">// 第一種寫法，為 obj 新增一個欄位 x，其值設定為 3</span>
  <span class="kw">this</span>[<span class="st">&quot;y&quot;</span>] = <span class="dv">5</span>;     <span class="co">// 第二種寫法，為 obj 新增一個欄位 y，其值設定為 5</span>
  <span class="kw">this</span>.<span class="fu">sum</span> = <span class="kw">function</span>() { <span class="kw">return</span> <span class="kw">this</span>.<span class="fu">x</span> + <span class="kw">this</span>.<span class="fu">y</span>; } <span class="co">// 為 obj 新增一個欄位 add，其值為一個匿名函數</span>
}

<span class="er">var o = new obj();</span>

<span class="er">document.write(&quot;o[&#39;x&#39;]=&quot;+o[&#39;x&#39;]+&quot; y=&quot;+o.y+&quot; sum()=&quot;+o.sum());</span>
<span class="kw">&lt;/script&gt;</span>

<span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<p>執行結果</p>
<div class="figure">
<img src="../img/jsObjectOutput.jpg" />
</div>
<h3 id="javascript-物件的繼承"><a href="#javascript-物件的繼承">JavaScript 物件的繼承</a></h3>
<p>物件導向中的繼承特性，是指「子物件」可以繼承「父物件」的資料與函數，並且進行修改，這樣我們就不需要重複的實作父物件已經有的函數，或者定義父物件已經有的資料，以達成程式碼重用的目的。</p>
<p>以下範例中的 Student 物件就繼承了 Person 物件，其方法是在 Student 物件的建構函數中，指定 this.prototype = Person 以達到繼承的目的，然後再呼叫 this.prototype(name, age) 以呼叫父物件的建構函數，建立出 name, age, toStr() 物件內容。</p>
<p>程式範例: inheritance.htm</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
<span class="kw">&lt;body&gt;</span>

<span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;</span>
<span class="er">function Person(name, age) {</span>
  <span class="kw">this</span>.<span class="fu">name</span> = name;
  <span class="kw">this</span>.<span class="fu">age</span> = age;
  <span class="kw">this</span>.<span class="fu">toStr</span> = <span class="kw">function</span>() { 
    <span class="kw">return</span> <span class="st">&quot;Person:name=&quot;</span>+<span class="kw">this</span>.<span class="fu">name</span>+<span class="st">&quot; age=&quot;</span>+<span class="kw">this</span>.<span class="fu">age</span>; 
  }
}
<span class="er">var john = new Person(&quot;John&quot;, 40);</span>

<span class="er">document.write(&quot;john.toStr()=&quot;+john.toStr()+&quot;&lt;BR/&gt;&quot;);</span>

<span class="er">function Student(name, age, grade) {</span>
  <span class="kw">this</span>.<span class="fu">prototype</span> = Person;
<span class="er">  this.prototype(name, age);</span>
  <span class="kw">this</span>.<span class="fu">grade</span> = grade;
  <span class="kw">this</span>.<span class="fu">toStr</span> = <span class="kw">function</span>() { 
    <span class="kw">return</span> <span class="st">&quot;Student:name=&quot;</span>+<span class="kw">this</span>.<span class="fu">name</span>+<span class="st">&quot; age=&quot;</span>+<span class="kw">this</span>.<span class="fu">age</span>+<span class="st">&quot; grade=&quot;</span>+<span class="kw">this</span>.<span class="fu">grade</span>; 
  }
}

<span class="er">var tony = new Student(&quot;Tony&quot;, 19, &quot;Freshman&quot;);</span>

<span class="er">document.write(&quot;tony.toStr()=&quot;+tony.toStr()+&quot;&lt;BR/&gt;&quot;);</span>
<span class="kw">&lt;/script&gt;</span>

<span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<p>執行結果</p>
<div class="figure">
<img src="../img/jsInheritanceOutput.jpg" />
</div>
<h3 id="javascript-物件的多型"><a href="#javascript-物件的多型">JavaScript 物件的多型</a></h3>
<p>物件導向中的多型特性，是指當不同的「子物件」繼承同一個「父物件」時，我們可以透過宣告父物件容器，卻將內容指向子物件的方式，以便呼叫到不同子物件中的對應函數。</p>
<p>以下範例中的 var array = [ john, tony ] 這一行，其中的 john 是 Person 類型的物件，tony 是 Student 類型的物件，但是由於 Student 繼承了 Person，而且兩者都有 toStr() 函數，因此當我們用 for (i in array) ... array[i].toStr() ... 這樣的方式呼叫 array[i].toStr() 時，對 john 物件會呼叫到 Person 的 toStr(), 而對 tony 物件會呼叫到 Student 的 toStr(), 這樣就達到了多型的結果。</p>
<p>程式範例: polymorphism.htm</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
<span class="kw">&lt;body&gt;</span>
 
<span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;</span>
<span class="er">function Person(name, age) {</span>
  <span class="kw">this</span>.<span class="fu">name</span> = name;
  <span class="kw">this</span>.<span class="fu">age</span> = age;
  <span class="kw">this</span>.<span class="fu">toStr</span> = <span class="kw">function</span>() { 
    <span class="kw">return</span> <span class="st">&quot;Person:name=&quot;</span>+<span class="kw">this</span>.<span class="fu">name</span>+<span class="st">&quot; age=&quot;</span>+<span class="kw">this</span>.<span class="fu">age</span>; 
  }
}
<span class="er">var john = new Person(&quot;John&quot;, 40);</span>
 
<span class="er">function Student(name, age, grade) {</span>
  <span class="kw">this</span>.<span class="fu">prototype</span> = Person;
<span class="er">  this.prototype(name, age);</span>
  <span class="kw">this</span>.<span class="fu">grade</span> = grade;
  <span class="kw">this</span>.<span class="fu">toStr</span> = <span class="kw">function</span>() { 
    <span class="kw">return</span> <span class="st">&quot;Student:name=&quot;</span>+<span class="kw">this</span>.<span class="fu">name</span>+<span class="st">&quot; age=&quot;</span>+<span class="kw">this</span>.<span class="fu">age</span>+<span class="st">&quot; grade=&quot;</span>+<span class="kw">this</span>.<span class="fu">grade</span>; 
  }
}
 
<span class="er">var tony = new Student(&quot;Tony&quot;, 19, &quot;Freshman&quot;);</span>
 
<span class="kw">var</span> array = [ john, tony ];
 
<span class="kw">for</span> (i <span class="kw">in</span> array)
<span class="er">  document.write(&quot;array[&quot;+i+&quot;].toStr()=&quot;+array[i].toStr()+&quot;&lt;BR/&gt;&quot;);</span>
&lt;<span class="ot">/script&gt;</span>
<span class="ot"> </span>
<span class="ot">&lt;/body</span>&gt;
&lt;<span class="ot">/html&gt;</span></code></pre>
<p>執行結果</p>
<div class="figure">
<img src="../img/jsPolymorphismOutput.jpg" />
</div>
<h3 id="javascript-物件的精簡表示法----json-物件資料交換格式"><a href="#javascript-物件的精簡表示法----json-物件資料交換格式">JavaScript 物件的精簡表示法 -- JSON 物件資料交換格式</a></h3>
<p>如果我們想直接在程式中宣告一個複雜的物件，可以使用 JavaScript 中的 {...} 與 [...] 的語法組合，用簡單的語法建構出整個物件。這種格式也常被用在網頁程式的資料交換當中，因此有一個很特別的名稱叫 JSON （Javascript Object Notation）。</p>
<p>目前網路上最常使用的資料交換格式是 XML，但是 XML 文件很繁瑣且囉嗦，讓使用者撰寫不方便，而且不容易嵌入網頁中進行處理。為了讓網頁上的共通程式語言 JavaScript 可以輕易的交換資料，網頁程式的設計者也常用 JSON 取代 XML 進行資料交換。</p>
<p>以下是一個採用 JSON 格式的朋友資料範例，該範例中有兩個朋友，一個是 John, 22 歲，另一個是 Mary, 28 歲。</p>
<pre class="sourceCode JavaScript"><code class="sourceCode javascript">{
  <span class="st">&quot;friends&quot;</span>: [
     {<span class="st">&quot;name&quot;</span>: <span class="st">&quot;John&quot;</span>, <span class="st">&quot;age&quot;</span>: <span class="dv">22</span> }
     {<span class="st">&quot;name&quot;</span>: <span class="st">&quot;Mary&quot;</span>, <span class="st">&quot;age&quot;</span>: <span class="dv">28</span> }
  ]
}</code></pre>
<p>程式範例：json.htm</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
<span class="kw">&lt;body&gt;</span>

<span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;</span>

<span class="kw">var</span> george = {
  <span class="st">&quot;name&quot;</span>: <span class="st">&quot;George&quot;</span>,
  <span class="st">&quot;age&quot;</span>: <span class="dv">25</span>,
  <span class="st">&quot;friends&quot;</span>: [
     {<span class="st">&quot;name&quot;</span>: <span class="st">&quot;John&quot;</span>, <span class="st">&quot;age&quot;</span>: <span class="dv">22</span> },
     {<span class="st">&quot;name&quot;</span>: <span class="st">&quot;Mary&quot;</span>, <span class="st">&quot;age&quot;</span>: <span class="dv">28</span> }
  ]
};

<span class="er">document.write(&quot;george.age=&quot;+george.age+&quot;&lt;br/&gt;&quot;);</span>
<span class="er">document.write(&quot;george.friends:\n&lt;ol&gt;&quot;);</span>
<span class="kw">var</span> friends = <span class="ot">george</span>.<span class="fu">friends</span>;
<span class="kw">for</span> (i <span class="kw">in</span> friends)
<span class="er">  document.write(&quot;&lt;li&gt;&quot;+friends[i].name+&quot; is &quot;+friends[i].age+&quot;years old!&lt;/li&gt;&quot;);</span>
<span class="er">document.write(&quot;&lt;/ol&gt;&quot;);</span>
&lt;<span class="ot">/script&gt;</span>
<span class="ot"> </span>
<span class="ot">&lt;/body</span>&gt;
&lt;<span class="ot">/html&gt;</span></code></pre>
<p>執行結果</p>
<div class="figure">
<img src="../img/jsJsonOutput.jpg" />
</div>
<p>以上我們簡單的介紹了 JavaScript 的物件導向功能，這種物件導向的實作方式由於是以原型為核心的，因此筆者喜歡稱 JavaScript 為原型導向 (prototype oriented) 的語言，雖然並不是很多人使用「原型導向」這個用法。</p>
<h2 id="javascript-的特殊技巧-closure-與匿名函數"><a href="#javascript-的特殊技巧-closure-與匿名函數">JavaScript 的特殊技巧 – Closure 與匿名函數</a></h2>
<p>在以下的程式中，我們同時展示了 JavaScript 當中的全域變數、區域變數與匿名函數、Closure 等機制。在本文中，我們會用這個程式逐步解釋一些 JavaScript 語言中重要但詭異的概念。</p>
<p>很多語言都有全域變數與區域變數之分，在 JavaScript 當中看來也是如此，但事實上 JavaScript 的全域變數其實只是最外層領域的區域變數而已，在瀏覽器當中，這個最外層領域就是 window，所以以下程式中最後一部分的 sum 與 windows.sum 都同樣是 8。</p>
<p>程式：closure.htm</p>
<pre class="sourceCode Html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
<span class="kw">&lt;body&gt;</span>

<span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;</span>
<span class="kw">var</span> sum = <span class="dv">0</span>;
<span class="er">function add(x) {</span>
  sum += x;
<span class="er">  document.write(&quot;typeof:x=&quot;+typeof x+&quot; y=&quot;+typeof y+&quot; z=&quot;+typeof z+&quot; sum=&quot;+typeof sum+&quot;&lt;br/&gt;&quot;);</span>
  <span class="kw">var</span> y = <span class="dv">2</span>;
  <span class="kw">return</span> <span class="kw">function</span>() {
    <span class="kw">var</span> z = x+y;
    <span class="ot">document</span>.<span class="fu">write</span>(<span class="st">&quot;value :x=&quot;</span>+x+<span class="st">&quot; y=&quot;</span>+y+<span class="st">&quot; z=&quot;</span>+z+<span class="st">&quot; sum=&quot;</span>+sum+<span class="st">&quot;&lt;br/&gt;&quot;</span>);
    <span class="ot">document</span>.<span class="fu">write</span>(<span class="st">&quot;typeof:x=&quot;</span>+<span class="kw">typeof</span> x+<span class="st">&quot; y=&quot;</span>+<span class="kw">typeof</span> y+<span class="st">&quot; z=&quot;</span>+<span class="kw">typeof</span> z+<span class="st">&quot; sum=&quot;</span>+<span class="kw">typeof</span> sum+<span class="st">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>);
  }
}

<span class="er">f = add(3);</span>
<span class="er">f();</span>

<span class="er">add(5)();</span>

<span class="er">document.write(&quot;typeof:x=&quot;+typeof x+&quot; y=&quot;+typeof y+&quot; z=&quot;+typeof z+&quot; sum=&quot;+typeof sum+&quot;&lt;br/&gt;&lt;br/&gt;&quot;);</span>

<span class="kw">&lt;/script&gt;</span>

<span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;</span>
<span class="er">document.write(&quot;sum=&quot;+sum+&quot; window.sum=&quot;+window.sum);</span>
<span class="kw">&lt;/script&gt;</span>

<span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<p>因此、JavaScript 可以說沒有全域變數的概念，全域變數的只不過是最外層物件的區域變數罷了。</p>
<p>在 JavaScript 每一層領域當中，都可以定義區域變數，例如在上述範例中，sum 是最外層變數，因此所有的程式區段都可以存取這個變數。</p>
<p>參數也是一種區域變數，像是 add(x) 當中的 x，也有領域慨念，其作用範圍僅適用於 add 裏面。而 add 當中所定義的區域變數 y，則只有在定義之後才會生效，因此其領域範圍是從 <code>var y=2;</code> 這行程式開始，一直到 add 函數結束為止。</p>
<p>JavaScript 當中的函數，可以沒有名稱，這種函數稱為匿名函數，像是上述範例的函數 add 中，就傳回了一個匿名函數，如下所示：</p>
<pre class="sourceCode JavaScript"><code class="sourceCode javascript"><span class="kw">function</span> <span class="fu">add</span>(x) {
  sum += x;
  <span class="ot">document</span>.<span class="fu">write</span>(<span class="st">&quot;typeof:x=&quot;</span>+<span class="kw">typeof</span> x+<span class="st">&quot; y=&quot;</span>+<span class="kw">typeof</span> y+<span class="st">&quot; z=&quot;</span>+<span class="kw">typeof</span> z+<span class="st">&quot; sum=&quot;</span>+<span class="kw">typeof</span> sum+<span class="st">&quot;&lt;br/&gt;&quot;</span>);
  <span class="kw">var</span> y = <span class="dv">2</span>;
  <span class="kw">return</span> <span class="kw">function</span>() {
    <span class="kw">var</span> z = sum+x+y;
    <span class="ot">document</span>.<span class="fu">write</span>(<span class="st">&quot;value :x=&quot;</span>+x+<span class="st">&quot; y=&quot;</span>+y+<span class="st">&quot; z=&quot;</span>+z+<span class="st">&quot; sum=&quot;</span>+sum+<span class="st">&quot;&lt;br/&gt;&quot;</span>);
    <span class="ot">document</span>.<span class="fu">write</span>(<span class="st">&quot;typeof:x=&quot;</span>+<span class="kw">typeof</span> x+<span class="st">&quot; y=&quot;</span>+<span class="kw">typeof</span> y+<span class="st">&quot; z=&quot;</span>+<span class="kw">typeof</span> z+<span class="st">&quot; sum=&quot;</span>+<span class="kw">typeof</span> sum+<span class="st">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>);
  }
}</code></pre>
<p>變數 z 是該匿名函數的區域變數，由於設定為 sum+x+y，因此存取了外層的 y、x 與更外層的 sum，領域的存取規則是內層可以存取外層的變數，但是外層卻不能存取內層的變數。</p>
<p>筆者認為，JavaScript 中的一個最特別且強大的特性，莫過於函數既可以塞給一般變數，也可以當參數傳遞。例如以下程式區段就是用 f 去接收 add(x) 函數所傳回來的匿名函數，然後再用 f() 函數去執行這個匿名函數而已。</p>
<pre class="sourceCode JavaScript"><code class="sourceCode javascript">f = <span class="fu">add</span>(<span class="dv">3</span>);
<span class="fu">f</span>();

<span class="fu">add</span>(<span class="dv">5</span>)();</code></pre>
<p>上列程式碼的最後一行 <code>add(5)()</code>，只不過是將這兩個動作合起來一起作，也就是呼叫 add(5) 後，傳回值是個匿名函數，然後再用「匿名函數()」這樣的方法呼叫函數，去執行該匿名函數而已。(這個功能有點像 C 當中的函數指標)</p>
<p>在上述的 closure.htm 程式中，還有個很特別的地方，就是這些匿名函數被傳回來後，就已經回到了最外層的領域範圍了 (window)，那麼當該匿名函數執行時，照理說由於 x, y 屬於內層 add 函數的區域變數，應該會存取不到才對，但為何程式執行結果卻都還是正常，沒有發生錯誤呢？</p>
<p>這牽涉到 JavaScript 當中一個非常特別的機制，稱為 Closure (閉包)。</p>
<p>閉包與 JavaScript 的領域 (Scope) 特性有關，因為 JavaScript 採用 Lexical Scope，也就是變數作用範圍依照程式定義時的上下文 (Context) 所決定，而不是根據執行時期的上下文所決定的。</p>
<p>因此，上述匿名函數所服從的領域規則，仍然是定義時的領域，也就是 add 函數的子領域，而不是執行時期 window 的子領域，因此仍然可以正確存取 x,y,z 等變數，不會發生錯誤。</p>
<h2 id="參考文獻"><a href="#參考文獻">參考文獻</a></h2>
<ul>
<li>Node.js 中文電子書 » JavaScript 與 NodeJS
<ul>
<li><a href="http://book.nodejs.tw/zh-tw/node_javascript.html#scope-closure">http://book.nodejs.tw/zh-tw/node_javascript.html#scope-closure</a></li>
</ul></li>
<li>[图解] 你不知道的 JavaScript - “this”
<ul>
<li><a href="http://www.cnblogs.com/ruxpinsp1/archive/2008/04/20/1162463.html">http://www.cnblogs.com/ruxpinsp1/archive/2008/04/20/1162463.html</a></li>
</ul></li>
<li>Javascript - 淺談this與Closure
<ul>
<li><a href="http://blog.darkthread.net/post-2009-03-11-js-this-and-closure.aspx">http://blog.darkthread.net/post-2009-03-11-js-this-and-closure.aspx</a></li>
</ul></li>
<li>The this keyword
<ul>
<li><a href="http://www.quirksmode.org/js/this.html">http://www.quirksmode.org/js/this.html</a></li>
</ul></li>
<li>JavaScript中的closure好難懂，它和匿名函式有什麼不同?
<ul>
<li><a href="http://ithelp.ithome.com.tw/question/10000477">http://ithelp.ithome.com.tw/question/10000477</a></li>
</ul></li>
</ul>
</div>
<div id="footer">
<a href="http://ccckmit.wikidot.com">陳鍾誠</a>衍生自<a href="http://zh.wikipedia.org/">維基百科</a>之作品：採用 <a href="http://creativecommons.org/licenses/by-sa/3.0/tw/ ">創作共用：姓名標示、相同方式分享</a> <a href="license.html">授權</a>
</div>
</body>
</html>
